## ðŸš€ Geostatistical Workflow

The programs should be executed sequentially, as the output of one serves as the input for the next.

| Step | Program | Functionality | Input Files | Output Files |
| :--- | :--- | :--- | :--- | :--- |
| **1. GIK & EGC** | `gik2` | Calculates the weights for Generalized Increments of order k (GIK) and generates the terms for the Experimental Generalized Covariance (EGC). | `[Input Data File]` | `gki.dat`, `cov.dat` |
| **2. Model Fitting**| `geko` | Fits the best Generalized Covariance (GC) models using Weighted Least Squares based on the EGC terms. | `cov.dat`, `modelos.dat` | `modcov.dat` |
| **3. Cross-Validation**| `crosval2` | Performs Leave-One-Out Cross-Validation (LOOCV) for each fitted model to assess prediction quality (Mean Squared Error). | `[Input Data File]`, `modcov.dat` | `cv.dat` |
| **4. Interpolation** | `faik2` | Executes the final Universal Kriging interpolation on a grid using the parameters of the chosen best-fit GC model. | `[Input Data File]`, `[GC Model Param]` | `faik.grd`, `faike.grd` |

-----

## 1\. `gik2` (Generalized Increments of Order k)

**Role:** This is the first step. It processes the raw data to prepare for model fitting.
**Output:**

  * `gki.dat`: Contains the GIK weights and indices.
  * `cov.dat`: Contains the experimental covariance terms used by `geko` for model fitting.

## 2\. `geko` (Generalized Covariance Kriging Optimization)

**Role:** Fits the Generalized Covariance (GC) model to the EGC terms generated by `gik2`.

### Input File: `modelos.dat`

The user must provide `modelos.dat`, which specifies the GC model components to test for fitting. Each line defines a model (1=include, 0=exclude):

| Term | C0 (Nugget) | C1 ($\|h\|$) | C3 ($\|h\|^3$) | C5 ($\|h\|^5$) | Clog ($\|h\|^2 \log\|h\|$) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Model Example** | 1 | 1 | 0 | 0 | 0 |
|||||||

**Output:**

  * `modcov.dat`: Stores the stable and fitted GC model parameters, ready for validation.

## 3\. `crosval2` (Cross-Validation)

**Role:** Evaluates the predictive accuracy of the models stored in `modcov.dat` using Leave-One-Out Cross-Validation (LOOCV).

**Output:**

  * `cv.dat`: Contains the Mean Squared Error (MSE) and the parameters for each model tested. This file is crucial for selecting the final best-fit model.

## 4\. `faik2` (Final Application of Kriging)

**Role:** Performs the final gridded estimation using the GC model selected from the `cv.dat` results.

**Execution Requirement:** Requires user input (or a configuration file) to specify:

1.  The **GC Model Parameters** (the line from `modcov.dat` corresponding to the best MSE in `cv.dat`).
2.  The **Grid Definition** (e.g., `xmin, xmax, ymin, ymax, bins, hist`).

**Output:**

  * `faik.grd`: The grid of estimated values ([DSAA format](https://surferhelp.goldensoftware.com/topics/ascii_grid_file_format.htm)).
  * `faike.grd`: The grid of Kriging standard deviations (error grid) ([DSAA format](https://surferhelp.goldensoftware.com/topics/ascii_grid_file_format.htm)).

---
---

# Example Workflow

## Data 

The main directory contains a sample data file `montebea.dat`. The suite expects the data to be organized as rows containing an identifier and the Z, X, and Y values â€‹â€‹for each point:

```bash
    $ head montebea.dat
    1 1430 150 1278
    2 1410 228 1182
    3 1510 292 1284
    4 1795 409 1350
    5 1743 400 1268
    6 1600 378 1216
    7 1815 460 1219
    8 1897 508 1318
    9 1760 549 1223
    10 1675 623 1273
```

Here is a view of this data:

![montebea.dat](pics/Pic_1.png)

and a summary:

    Data properties:
                id     Z           X            Y
    count  87.000000    87.000000   87.000000    87.000000
    mean   44.000000  1455.034483  529.977011   721.977011
    std    25.258662   266.054263  287.419836   410.964973
    min     1.000000   800.000000   34.000000    42.000000
    25%    22.500000  1271.000000  294.500000   372.000000
    50%    44.000000  1500.000000  539.000000   682.000000
    75%    65.500000  1616.000000  775.000000  1099.000000
    max    87.000000  2030.000000  992.000000  1390.000000


## `gik2`

```bash
    $ progs/bin/gik2 
    GIK2 PROGRAM: Calculation of generalized increments of order k

    Data filename:->montebea.dat

    montebea.dat has 87 data rows.

    Enter the order k (0,1,2):->1

    Enter the Number of Neighbors (<=32) :->12
    ix= 86      NÂ§ de GIK's:69       

    GKI.DAT file created with 69 generalized increments
```

##`geko`

```bash
    $ progs/bin/geko
    GEKO PROGRAM: Calculation of Generalized Covariances

    Processing GIK #:  69
```

## `crosval2`

```bash
    $ progs/bin/crosval2 
    CROSVAL PROGRAM: cross-validation of models

    Data filename:->montebea.dat

    montebea.dat has 87 data rows.

    Enter the order k (0,1,2):->1

    Enter the Number of Neighbors (<=32) :->12

    Fitted models file:->modcov.dat         

    ix=86
    25957.9 69
    14658.8 0 0 0 0
    ix=86
    25033.9 69
    0 -257.448 0 0 0
    ix=86
    30475 69
    0 0 0.0147918 0 0
    ix=86
    27925 69
    0 0 0 0 1.97794
    ix=86
    24928 69
    1260.75 -236.356 0 0 0
    ix=86
    28150.6 69
    7872.63 0 0.00802157 0 0
    ix=86
    26718.6 69
    6087.69 0 0 0 1.23531
    ix=86
    27625.3 69
    0 -178.131 0.00493953 0 0
    ix=86
    26374.2 69
    0 -166.108 0 0 0.716591
```

This result is writen to `cv.dat`:

```bash
    $ cat cv.dat

    25957.9 69
    14658.8 0 0 0 0
    25033.9 69
    0 -257.448 0 0 0
    30475 69
    0 0 0.0147918 0 0
    27925 69
    0 0 0 0 1.97794
    24928 69
    1260.75 -236.356 0 0 0
    28150.6 69
    7872.63 0 0.00802157 0 0
    26718.6 69
    6087.69 0 0 0 1.23531
    27625.3 69
    0 -178.131 0.00493953 0 0
    26374.2 69
    0 -166.108 0 0 0.716591
```
where there are two lines per model:

1. Variance, Number og GIK's used.
2. Parameters $C_i$ of the generalized covariance function: $
C(h) = C_0 + C_1|h| + C_3|h|^3 + C_5|h|^5 + C_{\log}|h|^2 \log(|h|)$

## `faik2`

```bash
    $ progs/bin/faik2 
    FAIK2 PROGRAM: Generalized Covariance Universal Kriging

    Data filename:->montebea.dat

    montebea.dat has 87 data rows. 
    (34<X<992) (42<Y<1390)

    Enter the order k (0,1,2):->1

    Enter the Number of Neighbors (<=32) :->12


    Enter model parameters
    0 -257.448 0 0 0


    X-Y coordinates of the region to be estimated
    Enter the coordinates of the bottom left corner :0 0

    Enter the coordinates of the upper right corner :1000 1400


    Numero de BINS e HIST :100 140 
    100   140
```

```bash
    $ ls -l *.grd
    -rw-r--r-- 1 jesus jesus 122421 dic 14 06:53 faike.grd
    -rw-r--r-- 1 jesus jesus 122412 dic 14 06:53 faik.grd
```

## Results

Unfortunately, vertical axis Y is inverted in the following graphs.

![Estimate](pics/Figure_1small.png)![EstiErrormate](pics/Figure_3small.png)

![Estimate3D](pics/Figure_2small.png)